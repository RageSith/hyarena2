{% extends "admin/layout.twig" %}

{% block title %}Bug Report #{{ report.id }}{% endblock %}

{% block content %}
<div class="admin-page">
    <div class="admin-page-header">
        <h1>Bug Report #{{ report.id }}</h1>
        <a href="/admin/bug-reports" class="btn btn-secondary">&larr; Back to List</a>
    </div>

    <div class="bug-report-detail">
        <div class="report-meta">
            <div class="meta-item">
                <span class="meta-label">Player</span>
                <span class="meta-value">{{ report.player_name }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">UUID</span>
                <span class="meta-value text-muted">{{ report.player_uuid }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Category</span>
                <span class="meta-value"><span class="badge badge-category-{{ report.category }}">{{ report.category|replace({'_': '/'})|upper }}</span></span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Status</span>
                <span class="meta-value"><span class="badge badge-bug-{{ report.status }}">{{ report.status }}</span></span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Submitted</span>
                <span class="meta-value">{{ report.created_at|date('M j, Y g:i A') }}</span>
            </div>
            {% if report.resolved_at %}
            <div class="meta-item">
                <span class="meta-label">Resolved</span>
                <span class="meta-value">{{ report.resolved_at|date('M j, Y g:i A') }}</span>
            </div>
            {% endif %}
        </div>

        <div class="report-section">
            <h3>Title</h3>
            <p>{{ report.title }}</p>
        </div>

        <div class="report-section">
            <h3>Description</h3>
            <div class="report-description">{{ report.description|nl2br }}</div>
        </div>

        {% if report.admin_notes %}
        <div class="report-section">
            <h3>Admin Notes</h3>
            <div class="report-description">{{ report.admin_notes|nl2br }}</div>
        </div>
        {% endif %}
    </div>

    <div class="admin-form" style="margin-top: 2rem;">
        <h3>Update Status</h3>
        <form method="POST" action="/admin/bug-reports/{{ report.id }}/status">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">

            <div class="form-group">
                <label>Status</label>
                <select name="status">
                    <option value="open" {% if report.status == 'open' %}selected{% endif %}>Open</option>
                    <option value="acknowledged" {% if report.status == 'acknowledged' %}selected{% endif %}>Acknowledged</option>
                    <option value="resolved" {% if report.status == 'resolved' %}selected{% endif %}>Resolved</option>
                    <option value="closed" {% if report.status == 'closed' %}selected{% endif %}>Closed</option>
                </select>
            </div>

            <div class="form-group">
                <label>Admin Notes</label>
                <textarea name="admin_notes" rows="4">{{ report.admin_notes }}</textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>

    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--admin-border);">
        <form method="POST" action="/admin/bug-reports/{{ report.id }}/delete" onsubmit="return confirm('Are you sure you want to delete this bug report?')">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
            <button type="submit" class="btn btn-danger">Delete Report</button>
        </form>
    </div>
</div>
{% endblock %}
