{% extends "base.twig" %}

{% block title %}Link Account - {{ site_name }}{% endblock %}

{% set active_tab = 'link' %}

{% set profile_nav %}
<nav class="profile-nav">
    <a href="/profile" class="profile-nav-link{{ active_tab == 'profile' ? ' active' : '' }}">Profile</a>
    <a href="/link" class="profile-nav-link{{ active_tab == 'link' ? ' active' : '' }}">Link Account</a>
    <a href="/profile/password" class="profile-nav-link{{ active_tab == 'password' ? ' active' : '' }}">Change Password</a>
</nav>
{% endset %}

{% block content %}
<div class="auth-page">
    <div class="auth-container" style="max-width: 700px;">
        {{ profile_nav }}

        <div class="auth-card">
            <div class="auth-header">
                <h1>Link Game Account</h1>
                {% if is_linked %}
                    <p>Your account is already linked!</p>
                {% else %}
                    <p>Enter the 6-character code from the in-game <code>/link</code> command.</p>
                {% endif %}
            </div>

            {% if error is defined and error %}
                <div class="alert alert-error">{{ error }}</div>
            {% endif %}

            {% if is_linked %}
                <div class="alert alert-success">Your game account is linked. <a href="/profile">View your profile</a></div>
            {% else %}
                <div class="alert alert-info">
                    Run <strong>/link</strong> in-game to get your code. The code expires after 10 minutes.
                </div>

                <form method="POST" id="link-form">
                    <div class="form-group">
                        <label for="code">Link Code</label>
                        <input type="text" id="code" name="code" class="form-input code-input" placeholder="ABC123" required maxlength="6" pattern="[A-Za-z0-9]{6}" autocomplete="off" value="{{ prefill_code }}">
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Link Account</button>
                </form>

                {% if prefill_code %}
                <script>document.getElementById('link-form').submit();</script>
                {% endif %}
            {% endif %}

            <div class="auth-footer">
                <a href="/profile">Back to Profile</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
